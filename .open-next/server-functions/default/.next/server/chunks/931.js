"use strict";exports.id=931,exports.ids=[931],exports.modules={7284:(a,b,c)=>{c.d(b,{HE:()=>k,Io:()=>o,Lf:()=>p,XI:()=>n,e:()=>g});var d=c(46493),e=c(35071);let f=Symbol.for("drizzle:Schema"),g=Symbol.for("drizzle:Columns"),h=Symbol.for("drizzle:ExtraConfigColumns"),i=Symbol.for("drizzle:OriginalName"),j=Symbol.for("drizzle:BaseName"),k=Symbol.for("drizzle:IsAlias"),l=Symbol.for("drizzle:ExtraConfigBuilder"),m=Symbol.for("drizzle:IsDrizzleTable");class n{static [d.i]="Table";static Symbol={Name:e.E,Schema:f,OriginalName:i,Columns:g,ExtraConfigColumns:h,BaseName:j,IsAlias:k,ExtraConfigBuilder:l};[e.E];[i];[f];[g];[h];[j];[k]=!1;[m]=!0;[l]=void 0;constructor(a,b,c){this[e.E]=this[i]=a,this[f]=b,this[j]=c}}function o(a){return a[e.E]}function p(a){return`${a[f]??"public"}.${a[e.E]}`}},19593:(a,b,c)=>{c.d(b,{n:()=>d});let d=Symbol.for("drizzle:ViewBaseConfig")},19643:(a,b,c)=>{c.d(b,{x:()=>h});var d=c(46493),e=c(31496);class f extends e.o{static [d.i]="SQLiteRealBuilder";constructor(a){super(a,"number","SQLiteReal")}build(a){return new g(a,this.config)}}class g extends e.v{static [d.i]="SQLiteReal";getSQLType(){return"real"}}function h(a){return new f(a??"")}},20377:(a,b,c)=>{c.d(b,{nd:()=>p});var d=c(46493),e=c(85766),f=c(41313),g=c(31496);class h extends g.o{static [d.i]="SQLiteBaseIntegerBuilder";constructor(a,b,c){super(a,b,c),this.config.autoIncrement=!1}primaryKey(a){return a?.autoIncrement&&(this.config.autoIncrement=!0),this.config.hasDefault=!0,super.primaryKey()}}class i extends g.v{static [d.i]="SQLiteBaseInteger";autoIncrement=this.config.autoIncrement;getSQLType(){return"integer"}}class j extends h{static [d.i]="SQLiteIntegerBuilder";constructor(a){super(a,"number","SQLiteInteger")}build(a){return new k(a,this.config)}}class k extends i{static [d.i]="SQLiteInteger"}class l extends h{static [d.i]="SQLiteTimestampBuilder";constructor(a,b){super(a,"date","SQLiteTimestamp"),this.config.mode=b}defaultNow(){return this.default((0,e.ll)`(cast((julianday('now') - 2440587.5)*86400000 as integer))`)}build(a){return new m(a,this.config)}}class m extends i{static [d.i]="SQLiteTimestamp";mode=this.config.mode;mapFromDriverValue(a){return new Date("timestamp"===this.config.mode?1e3*a:a)}mapToDriverValue(a){let b=a.getTime();return"timestamp"===this.config.mode?Math.floor(b/1e3):b}}class n extends h{static [d.i]="SQLiteBooleanBuilder";constructor(a,b){super(a,"boolean","SQLiteBoolean"),this.config.mode=b}build(a){return new o(a,this.config)}}class o extends i{static [d.i]="SQLiteBoolean";mode=this.config.mode;mapFromDriverValue(a){return 1===Number(a)}mapToDriverValue(a){return+!!a}}function p(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return d?.mode==="timestamp"||d?.mode==="timestamp_ms"?new l(c,d.mode):d?.mode==="boolean"?new n(c,d.mode):new j(c)}},31496:(a,b,c)=>{c.d(b,{v:()=>o,o:()=>n});var d=c(98046),e=c(80228),f=c(46493),g=c(35071);class h{static [f.i]="SQLiteForeignKeyBuilder";reference;_onUpdate;_onDelete;constructor(a,b){this.reference=()=>{let{name:b,columns:c,foreignColumns:d}=a();return{name:b,columns:c,foreignTable:d[0].table,foreignColumns:d}},b&&(this._onUpdate=b.onUpdate,this._onDelete=b.onDelete)}onUpdate(a){return this._onUpdate=a,this}onDelete(a){return this._onDelete=a,this}build(a){return new i(a,this)}}class i{constructor(a,b){this.table=a,this.reference=b.reference,this.onUpdate=b._onUpdate,this.onDelete=b._onDelete}static [f.i]="SQLiteForeignKey";reference;onUpdate;onDelete;getName(){let{name:a,columns:b,foreignColumns:c}=this.reference(),d=b.map(a=>a.name),e=c.map(a=>a.name),f=[this.table[g.E],...d,c[0].table[g.E],...e];return a??`${f.join("_")}_fk`}}function j(a,b){return`${a[g.E]}_${b.join("_")}_unique`}class k{constructor(a,b){this.name=b,this.columns=a}static [f.i]=null;columns;build(a){return new m(a,this.columns,this.name)}}class l{static [f.i]=null;name;constructor(a){this.name=a}on(...a){return new k(a,this.name)}}class m{constructor(a,b,c){this.table=a,this.columns=b,this.name=c??j(this.table,this.columns.map(a=>a.name))}static [f.i]=null;columns;name;getName(){return this.name}}class n extends d.Q{static [f.i]="SQLiteColumnBuilder";foreignKeyConfigs=[];references(a,b={}){return this.foreignKeyConfigs.push({ref:a,actions:b}),this}unique(a){return this.config.isUnique=!0,this.config.uniqueName=a,this}generatedAlwaysAs(a,b){return this.config.generated={as:a,type:"always",mode:b?.mode??"virtual"},this}buildForeignKeys(a,b){return this.foreignKeyConfigs.map(({ref:c,actions:d})=>((c,d)=>{let e=new h(()=>({columns:[a],foreignColumns:[c()]}));return d.onUpdate&&e.onUpdate(d.onUpdate),d.onDelete&&e.onDelete(d.onDelete),e.build(b)})(c,d))}}class o extends e.V{constructor(a,b){b.uniqueName||(b.uniqueName=j(a,[b.name])),super(a,b),this.table=a}static [f.i]="SQLiteColumn"}},35071:(a,b,c)=>{c.d(b,{E:()=>d});let d=Symbol.for("drizzle:Name")},41313:(a,b,c)=>{c.d(b,{DV:()=>k,He:()=>function a(b,c){return Object.entries(b).reduce((b,[i,j])=>{if("string"!=typeof i)return b;let k=c?[...c,i]:[i];return(0,e.is)(j,d.V)||(0,e.is)(j,f.Xs)||(0,e.is)(j,f.Xs.Aliased)||(0,e.is)(j,g.n)?b.push({path:k,field:j}):(0,e.is)(j,h.XI)?b.push(...a(j[h.XI.Symbol.Columns],k)):b.push(...a(j,k)),b},[])},Ll:()=>p,XJ:()=>m,YD:()=>n,a6:()=>j,q:()=>l,su:()=>q,zN:()=>o});var d=c(80228),e=c(46493),f=c(85766),g=c(96176),h=c(7284),i=c(19593);function j(a,b,c){let i={},j=a.reduce((a,{path:j,field:k},l)=>{let m;m=(0,e.is)(k,d.V)?k:(0,e.is)(k,f.Xs)?k.decoder:(0,e.is)(k,g.n)?k._.sql.decoder:k.sql.decoder;let n=a;for(let[a,f]of j.entries())if(a<j.length-1)f in n||(n[f]={}),n=n[f];else{let a=b[l],g=n[f]=null===a?null:m.mapFromDriverValue(a);if(c&&(0,e.is)(k,d.V)&&2===j.length){let a=j[0];a in i?"string"==typeof i[a]&&i[a]!==(0,h.Io)(k.table)&&(i[a]=!1):i[a]=null===g&&(0,h.Io)(k.table)}}return a},{});if(c&&Object.keys(i).length>0)for(let[a,b]of Object.entries(i))"string"!=typeof b||c[b]||(j[a]=null);return j}function k(a,b){let c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(let[a,b]of c.entries())if(b!==d[a])return!1;return!0}function l(a,b){let c=Object.entries(b).filter(([,a])=>void 0!==a).map(([b,c])=>(0,e.is)(c,f.Xs)||(0,e.is)(c,d.V)?[b,c]:[b,new f.Iw(c,a[h.XI.Symbol.Columns][b])]);if(0===c.length)throw Error("No values to set");return Object.fromEntries(c)}function m(a,b){for(let c of b)for(let b of Object.getOwnPropertyNames(c.prototype))"constructor"!==b&&Object.defineProperty(a.prototype,b,Object.getOwnPropertyDescriptor(c.prototype,b)||Object.create(null))}function n(a){return a[h.XI.Symbol.Columns]}function o(a){return(0,e.is)(a,g.n)?a._.alias:(0,e.is)(a,f.Ss)?a[i.n].name:(0,e.is)(a,f.Xs)?void 0:a[h.XI.Symbol.IsAlias]?a[h.XI.Symbol.Name]:a[h.XI.Symbol.BaseName]}function p(a,b){return{name:"string"==typeof a&&a.length>0?a:"",config:"object"==typeof a?a:b}}let q="undefined"==typeof TextDecoder?null:new TextDecoder},46493:(a,b,c)=>{c.d(b,{i:()=>d,is:()=>e});let d=Symbol.for("drizzle:entityKind");function e(a,b){if(!a||"object"!=typeof a)return!1;if(a instanceof b)return!0;if(!Object.prototype.hasOwnProperty.call(b,d))throw Error(`Class "${b.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let c=Object.getPrototypeOf(a).constructor;if(c)for(;c;){if(d in c&&c[d]===b[d])return!0;c=Object.getPrototypeOf(c)}return!1}Symbol.for("drizzle:hasOwnEntityKind")},48689:(a,b,c)=>{c.d(b,{AU:()=>m,B3:()=>B,KJ:()=>w,KL:()=>s,Pe:()=>u,RK:()=>A,RO:()=>o,RV:()=>r,Tq:()=>x,Uo:()=>k,eq:()=>i,gt:()=>n,kZ:()=>t,lt:()=>p,mj:()=>z,ne:()=>j,o8:()=>y,or:()=>l,q1:()=>C,t2:()=>v,wJ:()=>q});var d=c(80228),e=c(46493),f=c(7284),g=c(85766);function h(a,b){return!(0,g.eG)(b)||(0,g.qt)(a)||(0,e.is)(a,g.Iw)||(0,e.is)(a,g.Or)||(0,e.is)(a,d.V)||(0,e.is)(a,f.XI)||(0,e.is)(a,g.Ss)?a:new g.Iw(a,b)}let i=(a,b)=>(0,g.ll)`${a} = ${h(b,a)}`,j=(a,b)=>(0,g.ll)`${a} <> ${h(b,a)}`;function k(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new g.Xs(1===b.length?b:[new g.DJ("("),g.ll.join(b,new g.DJ(" and ")),new g.DJ(")")])}function l(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new g.Xs(1===b.length?b:[new g.DJ("("),g.ll.join(b,new g.DJ(" or ")),new g.DJ(")")])}function m(a){return(0,g.ll)`not ${a}`}let n=(a,b)=>(0,g.ll)`${a} > ${h(b,a)}`,o=(a,b)=>(0,g.ll)`${a} >= ${h(b,a)}`,p=(a,b)=>(0,g.ll)`${a} < ${h(b,a)}`,q=(a,b)=>(0,g.ll)`${a} <= ${h(b,a)}`;function r(a,b){return Array.isArray(b)?0===b.length?(0,g.ll)`false`:(0,g.ll)`${a} in ${b.map(b=>h(b,a))}`:(0,g.ll)`${a} in ${h(b,a)}`}function s(a,b){return Array.isArray(b)?0===b.length?(0,g.ll)`true`:(0,g.ll)`${a} not in ${b.map(b=>h(b,a))}`:(0,g.ll)`${a} not in ${h(b,a)}`}function t(a){return(0,g.ll)`${a} is null`}function u(a){return(0,g.ll)`${a} is not null`}function v(a){return(0,g.ll)`exists ${a}`}function w(a){return(0,g.ll)`not exists ${a}`}function x(a,b,c){return(0,g.ll)`${a} between ${h(b,a)} and ${h(c,a)}`}function y(a,b,c){return(0,g.ll)`${a} not between ${h(b,a)} and ${h(c,a)}`}function z(a,b){return(0,g.ll)`${a} like ${b}`}function A(a,b){return(0,g.ll)`${a} not like ${b}`}function B(a,b){return(0,g.ll)`${a} ilike ${b}`}function C(a,b){return(0,g.ll)`${a} not ilike ${b}`}},58040:(a,b,c)=>{c.d(b,{Qq:()=>k});var d=c(46493),e=c(41313),f=c(31496);class g extends f.o{static [d.i]="SQLiteTextBuilder";constructor(a,b){super(a,"string","SQLiteText"),this.config.enumValues=b.enum,this.config.length=b.length}build(a){return new h(a,this.config)}}class h extends f.v{static [d.i]="SQLiteText";enumValues=this.config.enumValues;length=this.config.length;constructor(a,b){super(a,b)}getSQLType(){return`text${this.config.length?`(${this.config.length})`:""}`}}class i extends f.o{static [d.i]="SQLiteTextJsonBuilder";constructor(a){super(a,"json","SQLiteTextJson")}build(a){return new j(a,this.config)}}class j extends f.v{static [d.i]="SQLiteTextJson";getSQLType(){return"text"}mapFromDriverValue(a){return JSON.parse(a)}mapToDriverValue(a){return JSON.stringify(a)}}function k(a,b={}){let{name:c,config:d}=(0,e.Ll)(a,b);return"json"===d.mode?new i(c):new g(c,d)}},61308:(a,b,c)=>{c.d(b,{f:()=>aC});var d=c(46493);class e{static [d.i]="ConsoleLogWriter";write(a){console.log(a)}}class f{static [d.i]="DefaultLogger";writer;constructor(a){this.writer=a?.writer??new e}logQuery(a,b){let c=b.map(a=>{try{return JSON.stringify(a)}catch{return String(a)}}),d=c.length?` -- params: [${c.join(", ")}]`:"";this.writer.write(`Query: ${a}${d}`)}}class g{static [d.i]="NoopLogger";logQuery(){}}var h=c(7284),i=c(80228);let j=Symbol.for("drizzle:PgInlineForeignKeys"),k=Symbol.for("drizzle:EnableRLS");class l extends h.XI{static [d.i]="PgTable";static Symbol=Object.assign({},h.XI.Symbol,{InlineForeignKeys:j,EnableRLS:k});[j]=[];[k]=!1;[h.XI.Symbol.ExtraConfigBuilder]=void 0;[h.XI.Symbol.ExtraConfigColumns]={}}class m{static [d.i]="PgPrimaryKeyBuilder";columns;name;constructor(a,b){this.columns=a,this.name=b}build(a){return new n(a,this.columns,this.name)}}class n{constructor(a,b,c){this.table=a,this.columns=b,this.name=c}static [d.i]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[l.Symbol.Name]}_${this.columns.map(a=>a.name).join("_")}_pk`}}var o=c(48689),p=c(71559),q=c(85766);class r{constructor(a,b,c){this.sourceTable=a,this.referencedTable=b,this.relationName=c,this.referencedTableName=b[h.XI.Symbol.Name]}static [d.i]="Relation";referencedTableName;fieldName}class s{constructor(a,b){this.table=a,this.config=b}static [d.i]="Relations"}class t extends r{constructor(a,b,c,d){super(a,b,c?.relationName),this.config=c,this.isNullable=d}static [d.i]="One";withFieldName(a){let b=new t(this.sourceTable,this.referencedTable,this.config,this.isNullable);return b.fieldName=a,b}}class u extends r{constructor(a,b,c){super(a,b,c?.relationName),this.config=c}static [d.i]="Many";withFieldName(a){let b=new u(this.sourceTable,this.referencedTable,this.config);return b.fieldName=a,b}}function v(a){return{one:function(b,c){return new t(a,b,c,c?.fields.reduce((a,b)=>a&&b.notNull,!0)??!1)},many:function(b,c){return new u(a,b,c)}}}var w=c(19593);class x{constructor(a){this.table=a}static [d.i]="ColumnAliasProxyHandler";get(a,b){return"table"===b?this.table:a[b]}}class y{constructor(a,b){this.alias=a,this.replaceOriginalName=b}static [d.i]="TableAliasProxyHandler";get(a,b){if(b===h.XI.Symbol.IsAlias)return!0;if(b===h.XI.Symbol.Name||this.replaceOriginalName&&b===h.XI.Symbol.OriginalName)return this.alias;if(b===w.n)return{...a[w.n],name:this.alias,isAlias:!0};if(b===h.XI.Symbol.Columns){let b=a[h.XI.Symbol.Columns];if(!b)return b;let c={};return Object.keys(b).map(d=>{c[d]=new Proxy(b[d],new x(new Proxy(a,this)))}),c}let c=a[b];return(0,d.is)(c,i.V)?new Proxy(c,new x(new Proxy(a,this))):c}}class z{constructor(a){this.alias=a}static [d.i]=null;get(a,b){return"sourceTable"===b?A(a.sourceTable,this.alias):a[b]}}function A(a,b){return new Proxy(a,new y(b,!1))}function B(a,b){return new Proxy(a,new x(new Proxy(a.table,new y(b,!1))))}function C(a,b){return new q.Xs.Aliased(D(a.sql,b),a.fieldAlias)}function D(a,b){return q.ll.join(a.queryChunks.map(a=>(0,d.is)(a,i.V)?B(a,b):(0,d.is)(a,q.Xs)?D(a,b):(0,d.is)(a,q.Xs.Aliased)?C(a,b):a))}var E=c(96176);class F{static [d.i]="SelectionProxyHandler";config;constructor(a){this.config={...a}}get(a,b){if("_"===b)return{...a._,selectedFields:new Proxy(a._.selectedFields,this)};if(b===w.n)return{...a[w.n],selectedFields:new Proxy(a[w.n].selectedFields,this)};if("symbol"==typeof b)return a[b];let c=((0,d.is)(a,E.n)?a._.selectedFields:(0,d.is)(a,q.Ss)?a[w.n].selectedFields:a)[b];if((0,d.is)(c,q.Xs.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!c.isSelectionField)return c.sql;let a=c.clone();return a.isSelectionField=!0,a}if((0,d.is)(c,q.Xs)){if("sql"===this.config.sqlBehavior)return c;throw Error(`You tried to reference "${b}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return(0,d.is)(c,i.V)?this.config.alias?new Proxy(c,new x(new Proxy(c.table,new y(this.config.alias,this.config.replaceOriginalName??!1)))):c:"object"!=typeof c||null===c?c:new Proxy(c,new F(this.config))}}function G(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(a=>a.toLowerCase()).join("_")}function H(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((a,b,c)=>a+(0===c?b.toLowerCase():`${b[0].toUpperCase()}${b.slice(1)}`),"")}function I(a){return a}class J{static [d.i]="CasingCache";cache={};cachedTables={};convert;constructor(a){this.convert="snake_case"===a?G:"camelCase"===a?H:I}getColumnCasing(a){if(!a.keyAsName)return a.name;let b=a.table[h.XI.Symbol.Schema]??"public",c=a.table[h.XI.Symbol.OriginalName],d=`${b}.${c}.${a.name}`;return this.cache[d]||this.cacheTable(a.table),this.cache[d]}cacheTable(a){let b=a[h.XI.Symbol.Schema]??"public",c=a[h.XI.Symbol.OriginalName],d=`${b}.${c}`;if(!this.cachedTables[d]){for(let b of Object.values(a[h.XI.Symbol.Columns])){let a=`${d}.${b.name}`;this.cache[a]=this.convert(b.name)}this.cachedTables[d]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class K extends Error{static [d.i]="DrizzleError";constructor({message:a,cause:b}){super(a),this.name="DrizzleError",this.cause=b}}class L extends Error{constructor(a,b,c){super(`Failed query: ${a}
params: ${b}`),this.query=a,this.params=b,this.cause=c,Error.captureStackTrace(this,L),c&&(this.cause=c)}}class M extends K{static [d.i]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}var N=c(31496),O=c(95417),P=c(41313);class Q extends q.Ss{static [d.i]="SQLiteViewBase"}class R{static [d.i]="SQLiteDialect";casing;constructor(a){this.casing=new J(a?.casing)}escapeName(a){return`"${a}"`}escapeParam(a){return"?"}escapeString(a){return`'${a.replace(/'/g,"''")}'`}buildWithCTE(a){if(!a?.length)return;let b=[(0,q.ll)`with `];for(let[c,d]of a.entries())b.push((0,q.ll)`${q.ll.identifier(d._.alias)} as (${d._.sql})`),c<a.length-1&&b.push((0,q.ll)`, `);return b.push((0,q.ll)` `),q.ll.join(b)}buildDeleteQuery({table:a,where:b,returning:c,withList:d,limit:e,orderBy:f}){let g=this.buildWithCTE(d),h=c?(0,q.ll)` returning ${this.buildSelection(c,{isSingleTable:!0})}`:void 0,i=b?(0,q.ll)` where ${b}`:void 0,j=this.buildOrderBy(f),k=this.buildLimit(e);return(0,q.ll)`${g}delete from ${a}${i}${h}${j}${k}`}buildUpdateSet(a,b){let c=a[h.XI.Symbol.Columns],e=Object.keys(c).filter(a=>void 0!==b[a]||c[a]?.onUpdateFn!==void 0),f=e.length;return q.ll.join(e.flatMap((a,e)=>{let g=c[a],h=g.onUpdateFn?.(),i=b[a]??((0,d.is)(h,q.Xs)?h:q.ll.param(h,g)),j=(0,q.ll)`${q.ll.identifier(this.casing.getColumnCasing(g))} = ${i}`;return e<f-1?[j,q.ll.raw(", ")]:[j]}))}buildUpdateQuery({table:a,set:b,where:c,returning:d,withList:e,joins:f,from:g,limit:h,orderBy:i}){let j=this.buildWithCTE(e),k=this.buildUpdateSet(a,b),l=g&&q.ll.join([q.ll.raw(" from "),this.buildFromTable(g)]),m=this.buildJoins(f),n=d?(0,q.ll)` returning ${this.buildSelection(d,{isSingleTable:!0})}`:void 0,o=c?(0,q.ll)` where ${c}`:void 0,p=this.buildOrderBy(i),r=this.buildLimit(h);return(0,q.ll)`${j}update ${a} set ${k}${l}${m}${o}${n}${p}${r}`}buildSelection(a,{isSingleTable:b=!1}={}){let c=a.length,e=a.flatMap(({field:a},e)=>{let f=[];if((0,d.is)(a,q.Xs.Aliased)&&a.isSelectionField)f.push(q.ll.identifier(a.fieldAlias));else if((0,d.is)(a,q.Xs.Aliased)||(0,d.is)(a,q.Xs)){let c=(0,d.is)(a,q.Xs.Aliased)?a.sql:a;b?f.push(new q.Xs(c.queryChunks.map(a=>(0,d.is)(a,i.V)?q.ll.identifier(this.casing.getColumnCasing(a)):a))):f.push(c),(0,d.is)(a,q.Xs.Aliased)&&f.push((0,q.ll)` as ${q.ll.identifier(a.fieldAlias)}`)}else if((0,d.is)(a,i.V)){let c=a.table[h.XI.Symbol.Name];"SQLiteNumericBigInt"===a.columnType?b?f.push((0,q.ll)`cast(${q.ll.identifier(this.casing.getColumnCasing(a))} as text)`):f.push((0,q.ll)`cast(${q.ll.identifier(c)}.${q.ll.identifier(this.casing.getColumnCasing(a))} as text)`):b?f.push(q.ll.identifier(this.casing.getColumnCasing(a))):f.push((0,q.ll)`${q.ll.identifier(c)}.${q.ll.identifier(this.casing.getColumnCasing(a))}`)}else if((0,d.is)(a,E.n)){let b=Object.entries(a._.selectedFields);if(1===b.length){let c=b[0][1],e=(0,d.is)(c,q.Xs)?c.decoder:(0,d.is)(c,i.V)?{mapFromDriverValue:a=>c.mapFromDriverValue(a)}:c.sql.decoder;e&&(a._.sql.decoder=e)}f.push(a)}return e<c-1&&f.push((0,q.ll)`, `),f});return q.ll.join(e)}buildJoins(a){if(!a||0===a.length)return;let b=[];if(a)for(let[c,e]of a.entries()){0===c&&b.push((0,q.ll)` `);let f=e.table,g=e.on?(0,q.ll)` on ${e.on}`:void 0;if((0,d.is)(f,O.jo)){let a=f[O.jo.Symbol.Name],c=f[O.jo.Symbol.Schema],d=f[O.jo.Symbol.OriginalName],h=a===d?void 0:e.alias;b.push((0,q.ll)`${q.ll.raw(e.joinType)} join ${c?(0,q.ll)`${q.ll.identifier(c)}.`:void 0}${q.ll.identifier(d)}${h&&(0,q.ll)` ${q.ll.identifier(h)}`}${g}`)}else b.push((0,q.ll)`${q.ll.raw(e.joinType)} join ${f}${g}`);c<a.length-1&&b.push((0,q.ll)` `)}return q.ll.join(b)}buildLimit(a){return"object"==typeof a||"number"==typeof a&&a>=0?(0,q.ll)` limit ${a}`:void 0}buildOrderBy(a){let b=[];if(a)for(let[c,d]of a.entries())b.push(d),c<a.length-1&&b.push((0,q.ll)`, `);return b.length>0?(0,q.ll)` order by ${q.ll.join(b)}`:void 0}buildFromTable(a){return(0,d.is)(a,h.XI)&&a[h.XI.Symbol.IsAlias]?(0,q.ll)`${(0,q.ll)`${q.ll.identifier(a[h.XI.Symbol.Schema]??"")}.`.if(a[h.XI.Symbol.Schema])}${q.ll.identifier(a[h.XI.Symbol.OriginalName])} ${q.ll.identifier(a[h.XI.Symbol.Name])}`:a}buildSelectQuery({withList:a,fields:b,fieldsFlat:c,where:e,having:f,table:g,joins:j,orderBy:k,groupBy:l,limit:m,offset:n,distinct:o,setOperators:p}){let r=c??(0,P.He)(b);for(let a of r){let b;if((0,d.is)(a.field,i.V)&&(0,h.Io)(a.field.table)!==((0,d.is)(g,E.n)?g._.alias:(0,d.is)(g,Q)?g[w.n].name:(0,d.is)(g,q.Xs)?void 0:(0,h.Io)(g))&&(b=a.field.table,!j?.some(({alias:a})=>a===(b[h.XI.Symbol.IsAlias]?(0,h.Io)(b):b[h.XI.Symbol.BaseName])))){let b=(0,h.Io)(a.field.table);throw Error(`Your "${a.path.join("->")}" field references a column "${b}"."${a.field.name}", but the table "${b}" is not part of the query! Did you forget to join it?`)}}let s=!j||0===j.length,t=this.buildWithCTE(a),u=o?(0,q.ll)` distinct`:void 0,v=this.buildSelection(r,{isSingleTable:s}),x=this.buildFromTable(g),y=this.buildJoins(j),z=e?(0,q.ll)` where ${e}`:void 0,A=f?(0,q.ll)` having ${f}`:void 0,B=[];if(l)for(let[a,b]of l.entries())B.push(b),a<l.length-1&&B.push((0,q.ll)`, `);let C=B.length>0?(0,q.ll)` group by ${q.ll.join(B)}`:void 0,D=this.buildOrderBy(k),F=this.buildLimit(m),G=n?(0,q.ll)` offset ${n}`:void 0,H=(0,q.ll)`${t}select${u} ${v} from ${x}${y}${z}${C}${A}${D}${F}${G}`;return p.length>0?this.buildSetOperations(H,p):H}buildSetOperations(a,b){let[c,...d]=b;if(!c)throw Error("Cannot pass undefined values to any set operator");return 0===d.length?this.buildSetOperationQuery({leftSelect:a,setOperator:c}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:a,setOperator:c}),d)}buildSetOperationQuery({leftSelect:a,setOperator:{type:b,isAll:c,rightSelect:e,limit:f,orderBy:g,offset:h}}){let i,j=(0,q.ll)`${a.getSQL()} `,k=(0,q.ll)`${e.getSQL()}`;if(g&&g.length>0){let a=[];for(let b of g)if((0,d.is)(b,N.v))a.push(q.ll.identifier(b.name));else if((0,d.is)(b,q.Xs)){for(let a=0;a<b.queryChunks.length;a++){let c=b.queryChunks[a];(0,d.is)(c,N.v)&&(b.queryChunks[a]=q.ll.identifier(this.casing.getColumnCasing(c)))}a.push((0,q.ll)`${b}`)}else a.push((0,q.ll)`${b}`);i=(0,q.ll)` order by ${q.ll.join(a,(0,q.ll)`, `)}`}let l="object"==typeof f||"number"==typeof f&&f>=0?(0,q.ll)` limit ${f}`:void 0,m=q.ll.raw(`${b} ${c?"all ":""}`),n=h?(0,q.ll)` offset ${h}`:void 0;return(0,q.ll)`${j}${m}${k}${i}${l}${n}`}buildInsertQuery({table:a,values:b,onConflict:c,returning:e,withList:f,select:g}){let i=[],j=Object.entries(a[h.XI.Symbol.Columns]).filter(([a,b])=>!b.shouldDisableInsert()),k=j.map(([,a])=>q.ll.identifier(this.casing.getColumnCasing(a)));if(g)(0,d.is)(b,q.Xs)?i.push(b):i.push(b.getSQL());else for(let[a,c]of(i.push(q.ll.raw("values ")),b.entries())){let e=[];for(let[a,b]of j){let f=c[a];if(void 0===f||(0,d.is)(f,q.Iw)&&void 0===f.value){let a;if(null!==b.default&&void 0!==b.default)a=(0,d.is)(b.default,q.Xs)?b.default:q.ll.param(b.default,b);else if(void 0!==b.defaultFn){let c=b.defaultFn();a=(0,d.is)(c,q.Xs)?c:q.ll.param(c,b)}else if(b.default||void 0===b.onUpdateFn)a=(0,q.ll)`null`;else{let c=b.onUpdateFn();a=(0,d.is)(c,q.Xs)?c:q.ll.param(c,b)}e.push(a)}else e.push(f)}i.push(e),a<b.length-1&&i.push((0,q.ll)`, `)}let l=this.buildWithCTE(f),m=q.ll.join(i),n=e?(0,q.ll)` returning ${this.buildSelection(e,{isSingleTable:!0})}`:void 0,o=c?.length?q.ll.join(c):void 0;return(0,q.ll)`${l}insert into ${a} ${k} ${m}${o}${n}`}sqlToQuery(a,b){return a.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:b})}buildRelationalQuery({fullSchema:a,schema:b,tableNamesMap:c,table:e,tableConfig:f,queryConfig:g,tableAlias:j,nestedQueryRelation:k,joinOn:l}){let m,n=[],r,s,v=[],w,x=[];if(!0===g)n=Object.entries(f.columns).map(([a,b])=>({dbKey:b.name,tsKey:a,field:B(b,j),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let e=Object.fromEntries(Object.entries(f.columns).map(([a,b])=>[a,B(b,j)]));if(g.where){let a="function"==typeof g.where?g.where(e,{and:o.Uo,between:o.Tq,eq:o.eq,exists:o.t2,gt:o.gt,gte:o.RO,ilike:o.B3,inArray:o.RV,isNull:o.kZ,isNotNull:o.Pe,like:o.mj,lt:o.lt,lte:o.wJ,ne:o.ne,not:o.AU,notBetween:o.o8,notExists:o.KJ,notLike:o.RK,notIlike:o.q1,notInArray:o.KL,or:o.or,sql:q.ll}):g.where;w=a&&D(a,j)}let k=[],l=[];if(g.columns){let a=!1;for(let[b,c]of Object.entries(g.columns))void 0!==c&&b in f.columns&&(a||!0!==c||(a=!0),l.push(b));l.length>0&&(l=a?l.filter(a=>g.columns?.[a]===!0):Object.keys(f.columns).filter(a=>!l.includes(a)))}else l=Object.keys(f.columns);for(let a of l){let b=f.columns[a];k.push({tsKey:a,value:b})}let m=[];if(g.with&&(m=Object.entries(g.with).filter(a=>!!a[1]).map(([a,b])=>({tsKey:a,queryConfig:b,relation:f.relations[a]}))),g.extras)for(let[a,b]of Object.entries("function"==typeof g.extras?g.extras(e,{sql:q.ll}):g.extras))k.push({tsKey:a,value:C(b,j)});for(let{tsKey:a,value:b}of k)n.push({dbKey:(0,d.is)(b,q.Xs.Aliased)?b.fieldAlias:f.columns[a].name,tsKey:a,field:(0,d.is)(b,i.V)?B(b,j):b,relationTableTsKey:void 0,isJson:!1,selection:[]});let u="function"==typeof g.orderBy?g.orderBy(e,{sql:q.ll,asc:p.Y,desc:p.i}):g.orderBy??[];for(let{tsKey:e,queryConfig:f,relation:k}of(Array.isArray(u)||(u=[u]),v=u.map(a=>(0,d.is)(a,i.V)?B(a,j):D(a,j)),r=g.limit,s=g.offset,m)){let g=function(a,b,c){if((0,d.is)(c,t)&&c.config)return{fields:c.config.fields,references:c.config.references};let e=b[(0,h.Lf)(c.referencedTable)];if(!e)throw Error(`Table "${c.referencedTable[h.XI.Symbol.Name]}" not found in schema`);let f=a[e];if(!f)throw Error(`Table "${e}" not found in schema`);let g=c.sourceTable,i=b[(0,h.Lf)(g)];if(!i)throw Error(`Table "${g[h.XI.Symbol.Name]}" not found in schema`);let j=[];for(let a of Object.values(f.relations))(c.relationName&&c!==a&&a.relationName===c.relationName||!c.relationName&&a.referencedTable===c.sourceTable)&&j.push(a);if(j.length>1)throw c.relationName?Error(`There are multiple relations with name "${c.relationName}" in table "${e}"`):Error(`There are multiple relations between "${e}" and "${c.sourceTable[h.XI.Symbol.Name]}". Please specify relation name`);if(j[0]&&(0,d.is)(j[0],t)&&j[0].config)return{fields:j[0].config.references,references:j[0].config.fields};throw Error(`There is not enough information to infer relation "${i}.${c.fieldName}"`)}(b,c,k),i=c[(0,h.Lf)(k.referencedTable)],l=`${j}_${e}`,m=(0,o.Uo)(...g.fields.map((a,b)=>(0,o.eq)(B(g.references[b],l),B(a,j)))),p=this.buildRelationalQuery({fullSchema:a,schema:b,tableNamesMap:c,table:a[i],tableConfig:b[i],queryConfig:(0,d.is)(k,t)?!0===f?{limit:1}:{...f,limit:1}:f,tableAlias:l,joinOn:m,nestedQueryRelation:k}),r=(0,q.ll)`(${p.sql})`.as(e);n.push({dbKey:e,tsKey:e,field:r,relationTableTsKey:i,isJson:!0,selection:p.selection})}}if(0===n.length)throw new K({message:`No fields selected for table "${f.tsName}" ("${j}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});if(w=(0,o.Uo)(l,w),k){let a=(0,q.ll)`json_array(${q.ll.join(n.map(({field:a})=>(0,d.is)(a,N.v)?q.ll.identifier(this.casing.getColumnCasing(a)):(0,d.is)(a,q.Xs.Aliased)?a.sql:a),(0,q.ll)`, `)})`;(0,d.is)(k,u)&&(a=(0,q.ll)`coalesce(json_group_array(${a}), json_array())`);let b=[{dbKey:"data",tsKey:"data",field:a.as("data"),isJson:!0,relationTableTsKey:f.tsName,selection:n}];void 0!==r||void 0!==s||v.length>0?(m=this.buildSelectQuery({table:A(e,j),fields:{},fieldsFlat:[{path:[],field:q.ll.raw("*")}],where:w,limit:r,offset:s,orderBy:v,setOperators:[]}),w=void 0,r=void 0,s=void 0,v=void 0):m=A(e,j),m=this.buildSelectQuery({table:(0,d.is)(m,O.jo)?m:new E.n(m,{},j),fields:{},fieldsFlat:b.map(({field:a})=>({path:[],field:(0,d.is)(a,i.V)?B(a,j):a})),joins:x,where:w,limit:r,offset:s,orderBy:v,setOperators:[]})}else m=this.buildSelectQuery({table:A(e,j),fields:{},fieldsFlat:n.map(({field:a})=>({path:[],field:(0,d.is)(a,i.V)?B(a,j):a})),joins:x,where:w,limit:r,offset:s,orderBy:v,setOperators:[]});return{tableTsKey:f.tsName,sql:m,selection:n}}}class S extends R{static [d.i]="SQLiteSyncDialect";migrate(a,b,c){let d=void 0===c||"string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",e=(0,q.ll)`
			CREATE TABLE IF NOT EXISTS ${q.ll.identifier(d)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;b.run(e);let f=b.values((0,q.ll)`SELECT id, hash, created_at FROM ${q.ll.identifier(d)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;b.run((0,q.ll)`BEGIN`);try{for(let c of a)if(!f||Number(f[2])<c.folderMillis){for(let a of c.sql)b.run(q.ll.raw(a));b.run((0,q.ll)`INSERT INTO ${q.ll.identifier(d)} ("hash", "created_at") VALUES(${c.hash}, ${c.folderMillis})`)}b.run((0,q.ll)`COMMIT`)}catch(a){throw b.run((0,q.ll)`ROLLBACK`),a}}}class T extends R{static [d.i]="SQLiteAsyncDialect";async migrate(a,b,c){let d=void 0===c||"string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",e=(0,q.ll)`
			CREATE TABLE IF NOT EXISTS ${q.ll.identifier(d)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await b.run(e);let f=(await b.values((0,q.ll)`SELECT id, hash, created_at FROM ${q.ll.identifier(d)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await b.transaction(async b=>{for(let c of a)if(!f||Number(f[2])<c.folderMillis){for(let a of c.sql)await b.run(q.ll.raw(a));await b.run((0,q.ll)`INSERT INTO ${q.ll.identifier(d)} ("hash", "created_at") VALUES(${c.hash}, ${c.folderMillis})`)}})}}class U{static [d.i]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class V{static [d.i]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}then(a,b){return this.execute().then(a,b)}}function W(a){return(0,d.is)(a,O.jo)?[`${a[h.XI.Symbol.BaseName]}`]:(0,d.is)(a,E.n)?a._.usedTables??[]:(0,d.is)(a,q.Xs)?a.usedTables??[]:[]}class X{static [d.i]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(a){this.fields=a.fields,this.session=a.session,this.dialect=a.dialect,this.withList=a.withList,this.distinct=a.distinct}from(a){let b,c=!!this.fields;return b=this.fields?this.fields:(0,d.is)(a,E.n)?Object.fromEntries(Object.keys(a._.selectedFields).map(b=>[b,a[b]])):(0,d.is)(a,Q)?a[w.n].selectedFields:(0,d.is)(a,q.Xs)?{}:(0,P.YD)(a),new Z({table:a,fields:b,isPartialSelect:c,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}class Y extends U{static [d.i]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:a,fields:b,isPartialSelect:c,session:d,dialect:e,withList:f,distinct:g}){for(let h of(super(),this.config={withList:f,table:a,fields:{...b},distinct:g,setOperators:[]},this.isPartialSelect=c,this.session=d,this.dialect=e,this._={selectedFields:b,config:this.config},this.tableName=(0,P.zN)(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{},W(a)))this.usedTables.add(h)}getUsedTables(){return[...this.usedTables]}createJoin(a){return(b,c)=>{let e=this.tableName,f=(0,P.zN)(b);for(let a of W(b))this.usedTables.add(a);if("string"==typeof f&&this.config.joins?.some(a=>a.alias===f))throw Error(`Alias "${f}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof e&&(this.config.fields={[e]:this.config.fields}),"string"==typeof f&&!(0,d.is)(b,q.Xs))){let a=(0,d.is)(b,E.n)?b._.selectedFields:(0,d.is)(b,q.Ss)?b[w.n].selectedFields:b[h.XI.Symbol.Columns];this.config.fields[f]=a}if("function"==typeof c&&(c=c(new Proxy(this.config.fields,new F({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:c,table:b,joinType:a,alias:f}),"string"==typeof f)switch(a){case"left":this.joinsNotNullableMap[f]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[f]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[f]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[f]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");crossJoin=this.createJoin("cross");createSetOperator(a,b){return c=>{let d="function"==typeof c?c(_()):c;if(!(0,P.DV)(this.getSelectedFields(),d.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:a,isAll:b,rightSelect:d}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(a){return this.config.setOperators.push(...a),this}where(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new F({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=a,this}having(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new F({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=a,this}groupBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new F({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(b)?b:[b]}else this.config.groupBy=a;return this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new F({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=c:this.config.orderBy=c}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=a:this.config.orderBy=a;return this}limit(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=a:this.config.limit=a,this}offset(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=a:this.config.offset=a,this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}as(a){let b=[];if(b.push(...W(this.config.table)),this.config.joins)for(let a of this.config.joins)b.push(...W(a.table));return new Proxy(new E.n(this.getSQL(),this.config.fields,a,!1,[...new Set(b)]),new F({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new F({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class Z extends Y{static [d.i]="SQLiteSelect";_prepare(a=!0){if(!this.session)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let b=(0,P.He)(this.config.fields),c=this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),b,"all",!0,void 0,{type:"select",tables:[...this.usedTables]},this.cacheConfig);return c.joinsNotNullableMap=this.joinsNotNullableMap,c}$withCache(a){return this.cacheConfig=void 0===a?{config:{},enable:!0,autoInvalidate:!0}:!1===a?{enable:!1}:{enable:!0,autoInvalidate:!0,...a},this}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.all()}}function $(a,b){return(c,d,...e)=>{let f=[d,...e].map(c=>({type:a,isAll:b,rightSelect:c}));for(let a of f)if(!(0,P.DV)(c.getSelectedFields(),a.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return c.addSetOperators(f)}}(0,P.XJ)(Z,[V]);let _=()=>({union:aa,unionAll:ab,intersect:ac,except:ad}),aa=$("union",!1),ab=$("union",!0),ac=$("intersect",!1),ad=$("except",!1);class ae{static [d.i]="SQLiteQueryBuilder";dialect;dialectConfig;constructor(a){this.dialect=(0,d.is)(a,R)?a:void 0,this.dialectConfig=(0,d.is)(a,R)?void 0:a}$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(c)),new Proxy(new E.J(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new F({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...a){let b=this;return{select:function(c){return new X({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a})},selectDistinct:function(c){return new X({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a,distinct:!0})}}}select(a){return new X({fields:a??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(a){return new X({fields:a??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){return this.dialect||(this.dialect=new S(this.dialectConfig)),this.dialect}}class af{constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [d.i]="SQLiteUpdateBuilder";set(a){return new ag(this.table,(0,P.q)(this.table,a),this.session,this.dialect,this.withList)}}class ag extends V{constructor(a,b,c,d,e){super(),this.session=c,this.dialect=d,this.config={set:b,table:a,withList:e,joins:[]}}static [d.i]="SQLiteUpdate";config;from(a){return this.config.from=a,this}createJoin(a){return(b,c)=>{let e=(0,P.zN)(b);if("string"==typeof e&&this.config.joins.some(a=>a.alias===e))throw Error(`Alias "${e}" is already used in this query`);if("function"==typeof c){let a=this.config.from?(0,d.is)(b,O.jo)?b[h.XI.Symbol.Columns]:(0,d.is)(b,E.n)?b._.selectedFields:(0,d.is)(b,Q)?b[w.n].selectedFields:void 0:void 0;c=c(new Proxy(this.config.table[h.XI.Symbol.Columns],new F({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new F({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}return this.config.joins.push({on:c,table:b,joinType:a,alias:e}),this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(a){return this.config.where=a,this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.table[h.XI.Symbol.Columns],new F({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.orderBy=c}else this.config.orderBy=a;return this}limit(a){return this.config.limit=a,this}returning(a=this.config.table[O.jo.Symbol.Columns]){return this.config.returning=(0,P.He)(a),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:W(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class ah{constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [d.i]="SQLiteInsertBuilder";values(a){if(0===(a=Array.isArray(a)?a:[a]).length)throw Error("values() must be called with at least one value");let b=a.map(a=>{let b={},c=this.table[h.XI.Symbol.Columns];for(let e of Object.keys(a)){let f=a[e];b[e]=(0,d.is)(f,q.Xs)?f:new q.Iw(f,c[e])}return b});return new ai(this.table,b,this.session,this.dialect,this.withList)}select(a){let b="function"==typeof a?a(new ae):a;if(!(0,d.is)(b,q.Xs)&&!(0,P.DV)(this.table[h.e],b._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new ai(this.table,b,this.session,this.dialect,this.withList,!0)}}class ai extends V{constructor(a,b,c,d,e,f){super(),this.session=c,this.dialect=d,this.config={table:a,values:b,withList:e,select:f}}static [d.i]="SQLiteInsert";config;returning(a=this.config.table[O.jo.Symbol.Columns]){return this.config.returning=(0,P.He)(a),this}onConflictDoNothing(a={}){if(this.config.onConflict||(this.config.onConflict=[]),void 0===a.target)this.config.onConflict.push((0,q.ll)` on conflict do nothing`);else{let b=Array.isArray(a.target)?(0,q.ll)`${a.target}`:(0,q.ll)`${[a.target]}`,c=a.where?(0,q.ll)` where ${a.where}`:(0,q.ll)``;this.config.onConflict.push((0,q.ll)` on conflict ${b} do nothing${c}`)}return this}onConflictDoUpdate(a){if(a.where&&(a.targetWhere||a.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');this.config.onConflict||(this.config.onConflict=[]);let b=a.where?(0,q.ll)` where ${a.where}`:void 0,c=a.targetWhere?(0,q.ll)` where ${a.targetWhere}`:void 0,d=a.setWhere?(0,q.ll)` where ${a.setWhere}`:void 0,e=Array.isArray(a.target)?(0,q.ll)`${a.target}`:(0,q.ll)`${[a.target]}`,f=this.dialect.buildUpdateSet(this.config.table,(0,P.q)(this.config.table,a.set));return this.config.onConflict.push((0,q.ll)` on conflict ${e}${c} do update set ${f}${b}${d}`),this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:W(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class aj extends V{constructor(a,b,c,d){super(),this.table=a,this.session=b,this.dialect=c,this.config={table:a,withList:d}}static [d.i]="SQLiteDelete";config;where(a){return this.config.where=a,this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.table[h.XI.Symbol.Columns],new F({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.orderBy=c}else this.config.orderBy=a;return this}limit(a){return this.config.limit=a,this}returning(a=this.table[O.jo.Symbol.Columns]){return this.config.returning=(0,P.He)(a),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"delete",tables:W(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(a){return this._prepare().execute(a)}$dynamic(){return this}}class ak extends q.Xs{constructor(a){super(ak.buildEmbeddedCount(a.source,a.filters).queryChunks),this.params=a,this.session=a.session,this.sql=ak.buildCount(a.source,a.filters)}sql;static [d.i]="SQLiteCountBuilderAsync";[Symbol.toStringTag]="SQLiteCountBuilderAsync";session;static buildEmbeddedCount(a,b){return(0,q.ll)`(select count(*) from ${a}${q.ll.raw(" where ").if(b)}${b})`}static buildCount(a,b){return(0,q.ll)`select count(*) from ${a}${q.ll.raw(" where ").if(b)}${b}`}then(a,b){return Promise.resolve(this.session.count(this.sql)).then(a,b)}catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}}class al{constructor(a,b,c,d,e,f,g,h){this.mode=a,this.fullSchema=b,this.schema=c,this.tableNamesMap=d,this.table=e,this.tableConfig=f,this.dialect=g,this.session=h}static [d.i]="SQLiteAsyncRelationalQueryBuilder";findMany(a){return"sync"===this.mode?new an(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many"):new am(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many")}findFirst(a){return"sync"===this.mode?new an(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first"):new am(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first")}}class am extends V{constructor(a,b,c,d,e,f,g,h,i){super(),this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g,this.config=h,this.mode=i}static [d.i]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(a=!1){let{query:b,builtQuery:c}=this._toSQL();return this.session[a?"prepareOneTimeQuery":"prepareQuery"](c,void 0,"first"===this.mode?"get":"all",!0,(a,c)=>{let e=a.map(a=>(function a(b,c,e,f,g=a=>a){let h={};for(let[j,k]of f.entries())if(k.isJson){let f=c.relations[k.tsKey],i=e[j],l="string"==typeof i?JSON.parse(i):i;h[k.tsKey]=(0,d.is)(f,t)?l&&a(b,b[k.relationTableTsKey],l,k.selection,g):l.map(c=>a(b,b[k.relationTableTsKey],c,k.selection,g))}else{let a,b=g(e[j]),c=k.field;a=(0,d.is)(c,i.V)?c:(0,d.is)(c,q.Xs)?c.decoder:c.sql.decoder,h[k.tsKey]=null===b?null:a.mapFromDriverValue(b)}return h})(this.schema,this.tableConfig,a,b.selection,c));return"first"===this.mode?e[0]:e})}prepare(){return this._prepare(!1)}_toSQL(){let a=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),b=this.dialect.sqlToQuery(a.sql);return{query:a,builtQuery:b}}toSQL(){return this._toSQL().builtQuery}executeRaw(){return"first"===this.mode?this._prepare(!1).get():this._prepare(!1).all()}async execute(){return this.executeRaw()}}class an extends am{static [d.i]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}}class ao extends V{constructor(a,b,c,d,e){super(),this.execute=a,this.getSQL=b,this.dialect=d,this.mapBatchResult=e,this.config={action:c}}static [d.i]="SQLiteRaw";config;getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(a,b){return b?this.mapBatchResult(a):a}_prepare(){return this}isResponseInArrayMode(){return!1}}class ap{constructor(a,b,c,d){this.resultKind=a,this.dialect=b,this.session=c,this._=d?{schema:d.schema,fullSchema:d.fullSchema,tableNamesMap:d.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={};let e=this.query;if(this._.schema)for(let[f,g]of Object.entries(this._.schema))e[f]=new al(a,d.fullSchema,this._.schema,this._.tableNamesMap,d.fullSchema[f],g,b,c);this.$cache={invalidate:async a=>{}}}static [d.i]="BaseSQLiteDatabase";query;$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(new ae(c.dialect))),new Proxy(new E.J(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new F({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(a,b){return new ak({source:a,filters:b,session:this.session})}with(...a){let b=this;return{select:function(c){return new X({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a})},selectDistinct:function(c){return new X({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:!0})},update:function(c){return new af(c,b.session,b.dialect,a)},insert:function(c){return new ah(c,b.session,b.dialect,a)},delete:function(c){return new aj(c,b.session,b.dialect,a)}}}select(a){return new X({fields:a??void 0,session:this.session,dialect:this.dialect})}selectDistinct(a){return new X({fields:a??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(a){return new af(a,this.session,this.dialect)}$cache;insert(a){return new ah(a,this.session,this.dialect)}delete(a){return new aj(a,this.session,this.dialect)}run(a){let b="string"==typeof a?q.ll.raw(a):a.getSQL();return"async"===this.resultKind?new ao(async()=>this.session.run(b),()=>b,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session)):this.session.run(b)}all(a){let b="string"==typeof a?q.ll.raw(a):a.getSQL();return"async"===this.resultKind?new ao(async()=>this.session.all(b),()=>b,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session)):this.session.all(b)}get(a){let b="string"==typeof a?q.ll.raw(a):a.getSQL();return"async"===this.resultKind?new ao(async()=>this.session.get(b),()=>b,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session)):this.session.get(b)}values(a){let b="string"==typeof a?q.ll.raw(a):a.getSQL();return"async"===this.resultKind?new ao(async()=>this.session.values(b),()=>b,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session)):this.session.values(b)}transaction(a,b){return this.session.transaction(a,b)}}class aq{static [d.i]="Cache"}class ar extends aq{strategy(){return"all"}static [d.i]="NoopCache";async get(a){}async put(a,b,c,d){}async onMutate(a){}}async function as(a,b){let c=`${a}-${JSON.stringify(b)}`,d=new TextEncoder().encode(c);return[...new Uint8Array(await crypto.subtle.digest("SHA-256",d))].map(a=>a.toString(16).padStart(2,"0")).join("")}class at extends V{constructor(a){super(),this.resultCb=a}static [d.i]="ExecuteResultSync";async execute(){return this.resultCb()}sync(){return this.resultCb()}}class au{constructor(a,b,c,d,e,f){this.mode=a,this.executeMethod=b,this.query=c,this.cache=d,this.queryMetadata=e,this.cacheConfig=f,d&&"all"===d.strategy()&&void 0===f&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}static [d.i]="PreparedQuery";joinsNotNullableMap;async queryWithCache(a,b,c){if(void 0===this.cache||(0,d.is)(this.cache,ar)||void 0===this.queryMetadata||this.cacheConfig&&!this.cacheConfig.enable)try{return await c()}catch(c){throw new L(a,b,c)}if(("insert"===this.queryMetadata.type||"update"===this.queryMetadata.type||"delete"===this.queryMetadata.type)&&this.queryMetadata.tables.length>0)try{let[a]=await Promise.all([c(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return a}catch(c){throw new L(a,b,c)}if(!this.cacheConfig)try{return await c()}catch(c){throw new L(a,b,c)}if("select"===this.queryMetadata.type){let d=await this.cache.get(this.cacheConfig.tag??await as(a,b),this.queryMetadata.tables,void 0!==this.cacheConfig.tag,this.cacheConfig.autoInvalidate);if(void 0===d){let d;try{d=await c()}catch(c){throw new L(a,b,c)}return await this.cache.put(this.cacheConfig.tag??await as(a,b),d,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],void 0!==this.cacheConfig.tag,this.cacheConfig.config),d}return d}try{return await c()}catch(c){throw new L(a,b,c)}}getQuery(){return this.query}mapRunResult(a,b){return a}mapAllResult(a,b){throw Error("Not implemented")}mapGetResult(a,b){throw Error("Not implemented")}execute(a){return"async"===this.mode?this[this.executeMethod](a):new at(()=>this[this.executeMethod](a))}mapResult(a,b){switch(this.executeMethod){case"run":return this.mapRunResult(a,b);case"all":return this.mapAllResult(a,b);case"get":return this.mapGetResult(a,b)}}}class av{constructor(a){this.dialect=a}static [d.i]="SQLiteSession";prepareOneTimeQuery(a,b,c,d,e,f,g){return this.prepareQuery(a,b,c,d,e,f,g)}run(a){let b=this.dialect.sqlToQuery(a);try{return this.prepareOneTimeQuery(b,void 0,"run",!1).run()}catch(a){throw new K({cause:a,message:`Failed to run the query '${b.sql}'`})}}extractRawRunValueFromBatchResult(a){return a}all(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).all()}extractRawAllValueFromBatchResult(a){throw Error("Not implemented")}get(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).get()}extractRawGetValueFromBatchResult(a){throw Error("Not implemented")}values(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).values()}async count(a){return(await this.values(a))[0][0]}extractRawValuesValueFromBatchResult(a){throw Error("Not implemented")}}class aw extends ap{constructor(a,b,c,d,e=0){super(a,b,c,d),this.schema=d,this.nestedIndex=e}static [d.i]="SQLiteTransaction";rollback(){throw new M}}class ax extends av{constructor(a,b,c,d={}){super(b),this.client=a,this.schema=c,this.options=d,this.logger=d.logger??new g,this.cache=d.cache??new ar}static [d.i]="SQLiteD1Session";logger;cache;prepareQuery(a,b,c,d,e,f,g){return new aA(this.client.prepare(a.sql),a,this.logger,this.cache,f,g,b,c,d,e)}async batch(a){let b=[],c=[];for(let d of a){let a=d._prepare(),e=a.getQuery();if(b.push(a),e.params.length>0)c.push(a.stmt.bind(...e.params));else{let b=a.getQuery();c.push(this.client.prepare(b.sql).bind(...b.params))}}return(await this.client.batch(c)).map((a,c)=>b[c].mapResult(a,!0))}extractRawAllValueFromBatchResult(a){return a.results}extractRawGetValueFromBatchResult(a){return a.results[0]}extractRawValuesValueFromBatchResult(a){return az(a.results)}async transaction(a,b){let c=new ay("async",this.dialect,this,this.schema);await this.run(q.ll.raw(`begin${b?.behavior?" "+b.behavior:""}`));try{let b=await a(c);return await this.run((0,q.ll)`commit`),b}catch(a){throw await this.run((0,q.ll)`rollback`),a}}}class ay extends aw{static [d.i]="D1Transaction";async transaction(a){let b=`sp${this.nestedIndex}`,c=new ay("async",this.dialect,this.session,this.schema,this.nestedIndex+1);await this.session.run(q.ll.raw(`savepoint ${b}`));try{let d=await a(c);return await this.session.run(q.ll.raw(`release savepoint ${b}`)),d}catch(a){throw await this.session.run(q.ll.raw(`rollback to savepoint ${b}`)),a}}}function az(a){let b=[];for(let c of a){let a=Object.keys(c).map(a=>c[a]);b.push(a)}return b}class aA extends au{constructor(a,b,c,d,e,f,g,h,i,j){super("async",h,b,d,e,f),this.logger=c,this._isResponseInArrayMode=i,this.customResultMapper=j,this.fields=g,this.stmt=a}static [d.i]="D1PreparedQuery";customResultMapper;fields;stmt;async run(a){let b=(0,q.Ct)(this.query.params,a??{});return this.logger.logQuery(this.query.sql,b),await this.queryWithCache(this.query.sql,b,async()=>this.stmt.bind(...b).run())}async all(a){let{fields:b,query:c,logger:d,stmt:e,customResultMapper:f}=this;if(!b&&!f){let b=(0,q.Ct)(c.params,a??{});return d.logQuery(c.sql,b),await this.queryWithCache(c.sql,b,async()=>e.bind(...b).all().then(({results:a})=>this.mapAllResult(a)))}let g=await this.values(a);return this.mapAllResult(g)}mapAllResult(a,b){return(b&&(a=az(a.results)),this.fields||this.customResultMapper)?this.customResultMapper?this.customResultMapper(a):a.map(a=>(0,P.a6)(this.fields,a,this.joinsNotNullableMap)):a}async get(a){let{fields:b,joinsNotNullableMap:c,query:d,logger:e,stmt:f,customResultMapper:g}=this;if(!b&&!g){let b=(0,q.Ct)(d.params,a??{});return e.logQuery(d.sql,b),await this.queryWithCache(d.sql,b,async()=>f.bind(...b).all().then(({results:a})=>a[0]))}let h=await this.values(a);if(h[0])return g?g(h):(0,P.a6)(b,h[0],c)}mapGetResult(a,b){return(b&&(a=az(a.results)[0]),this.fields||this.customResultMapper)?this.customResultMapper?this.customResultMapper([a]):(0,P.a6)(this.fields,a,this.joinsNotNullableMap):a}async values(a){let b=(0,q.Ct)(this.query.params,a??{});return this.logger.logQuery(this.query.sql,b),await this.queryWithCache(this.query.sql,b,async()=>this.stmt.bind(...b).raw())}isResponseInArrayMode(){return this._isResponseInArrayMode}}class aB extends ap{static [d.i]="D1Database";async batch(a){return this.session.batch(a)}}function aC(a,b={}){let c,e,g=new T({casing:b.casing});if(!0===b.logger?c=new f:!1!==b.logger&&(c=b.logger),b.schema){let a=function(a,b){1===Object.keys(a).length&&"default"in a&&!(0,d.is)(a.default,h.XI)&&(a=a.default);let c={},e={},f={};for(let[g,i]of Object.entries(a))if((0,d.is)(i,h.XI)){let a=(0,h.Lf)(i),b=e[a];for(let d of(c[a]=g,f[g]={tsName:g,dbName:i[h.XI.Symbol.Name],schema:i[h.XI.Symbol.Schema],columns:i[h.XI.Symbol.Columns],relations:b?.relations??{},primaryKey:b?.primaryKey??[]},Object.values(i[h.XI.Symbol.Columns])))d.primary&&f[g].primaryKey.push(d);let j=i[h.XI.Symbol.ExtraConfigBuilder]?.(i[h.XI.Symbol.ExtraConfigColumns]);if(j)for(let a of Object.values(j))(0,d.is)(a,m)&&f[g].primaryKey.push(...a.columns)}else if((0,d.is)(i,s)){let a,d=(0,h.Lf)(i.table),g=c[d];for(let[c,h]of Object.entries(i.config(b(i.table))))if(g){let b=f[g];b.relations[c]=h,a&&b.primaryKey.push(...a)}else d in e||(e[d]={relations:{},primaryKey:a}),e[d].relations[c]=h}return{tables:f,tableNamesMap:c}}(b.schema,v);e={fullSchema:b.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let i=new ax(a,g,e,{logger:c,cache:b.cache}),j=new aB("async",g,i,e);return j.$client=a,j.$cache=b.cache,j.$cache&&(j.$cache.invalidate=b.cache?.onMutate),j}},71559:(a,b,c)=>{c.d(b,{Y:()=>e,i:()=>f});var d=c(85766);function e(a){return(0,d.ll)`${a} asc`}function f(a){return(0,d.ll)`${a} desc`}},80228:(a,b,c)=>{c.d(b,{V:()=>e});var d=c(46493);class e{constructor(a,b){this.table=a,this.config=b,this.name=b.name,this.keyAsName=b.keyAsName,this.notNull=b.notNull,this.default=b.default,this.defaultFn=b.defaultFn,this.onUpdateFn=b.onUpdateFn,this.hasDefault=b.hasDefault,this.primary=b.primaryKey,this.isUnique=b.isUnique,this.uniqueName=b.uniqueName,this.uniqueType=b.uniqueType,this.dataType=b.dataType,this.columnType=b.columnType,this.generated=b.generated,this.generatedIdentity=b.generatedIdentity}static [d.i]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(a){return a}mapToDriverValue(a){return a}shouldDisableInsert(){return void 0!==this.config.generated&&"byDefault"!==this.config.generated.type}}},85766:(a,b,c)=>{let d,e;c.d(b,{Iw:()=>O,Or:()=>Q,Xs:()=>J,DJ:()=>I,Ss:()=>T,Ct:()=>R,eG:()=>L,qt:()=>H,ll:()=>P});var f=c(46493),g=c(98046),h=c(80228),i=c(35071);class j{static [f.i]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(a,b){this.reference=()=>{let{name:b,columns:c,foreignColumns:d}=a();return{name:b,columns:c,foreignTable:d[0].table,foreignColumns:d}},b&&(this._onUpdate=b.onUpdate,this._onDelete=b.onDelete)}onUpdate(a){return this._onUpdate=void 0===a?"no action":a,this}onDelete(a){return this._onDelete=void 0===a?"no action":a,this}build(a){return new k(a,this)}}class k{constructor(a,b){this.table=a,this.reference=b.reference,this.onUpdate=b._onUpdate,this.onDelete=b._onDelete}static [f.i]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:a,columns:b,foreignColumns:c}=this.reference(),d=b.map(a=>a.name),e=c.map(a=>a.name),f=[this.table[i.E],...d,c[0].table[i.E],...e];return a??`${f.join("_")}_fk`}}function l(a,...b){return a(...b)}function m(a,b){return`${a[i.E]}_${b.join("_")}_unique`}class n{constructor(a,b){this.name=b,this.columns=a}static [f.i]=null;columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(a){return new p(a,this.columns,this.nullsNotDistinctConfig,this.name)}}class o{static [f.i]=null;name;constructor(a){this.name=a}on(...a){return new n(a,this.name)}}class p{constructor(a,b,c,d){this.table=a,this.columns=b,this.name=d??m(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=c}static [f.i]=null;columns;name;nullsNotDistinct=!1;getName(){return this.name}}function q(a,b,c){for(let d=b;d<a.length;d++){let e=a[d];if("\\"===e){d++;continue}if('"'===e)return[a.slice(b,d).replace(/\\/g,""),d+1];if(!c&&(","===e||"}"===e))return[a.slice(b,d).replace(/\\/g,""),d]}return[a.slice(b).replace(/\\/g,""),a.length]}class r extends g.Q{foreignKeyConfigs=[];static [f.i]="PgColumnBuilder";array(a){return new v(this.config.name,this,a)}references(a,b={}){return this.foreignKeyConfigs.push({ref:a,actions:b}),this}unique(a,b){return this.config.isUnique=!0,this.config.uniqueName=a,this.config.uniqueType=b?.nulls,this}generatedAlwaysAs(a){return this.config.generated={as:a,type:"always",mode:"stored"},this}buildForeignKeys(a,b){return this.foreignKeyConfigs.map(({ref:c,actions:d})=>l((c,d)=>{let e=new j(()=>({columns:[a],foreignColumns:[c()]}));return d.onUpdate&&e.onUpdate(d.onUpdate),d.onDelete&&e.onDelete(d.onDelete),e.build(b)},c,d))}buildExtraConfigColumn(a){return new t(a,this.config)}}class s extends h.V{constructor(a,b){b.uniqueName||(b.uniqueName=m(a,[b.name])),super(a,b),this.table=a}static [f.i]="PgColumn"}class t extends s{static [f.i]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(a){return this.indexConfig.opClass=a,this}}class u{static [f.i]=null;constructor(a,b,c,d){this.name=a,this.keyAsName=b,this.type=c,this.indexConfig=d}name;keyAsName;type;indexConfig}class v extends r{static [f.i]="PgArrayBuilder";constructor(a,b,c){super(a,"array","PgArray"),this.config.baseBuilder=b,this.config.size=c}build(a){let b=this.config.baseBuilder.build(a);return new w(a,this.config,b)}}class w extends s{constructor(a,b,c,d){super(a,b),this.baseColumn=c,this.range=d,this.size=b.size}size;static [f.i]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(a){return"string"==typeof a&&(a=function(a){let[b]=function a(b,c=0){let d=[],e=c,f=!1;for(;e<b.length;){let g=b[e];if(","===g){(f||e===c)&&d.push(""),f=!0,e++;continue}if(f=!1,"\\"===g){e+=2;continue}if('"'===g){let[a,c]=q(b,e+1,!0);d.push(a),e=c;continue}if("}"===g)return[d,e+1];if("{"===g){let[c,f]=a(b,e+1);d.push(c),e=f;continue}let[h,i]=q(b,e,!1);d.push(h),e=i}return[d,e]}(a,1);return b}(a)),a.map(a=>this.baseColumn.mapFromDriverValue(a))}mapToDriverValue(a,b=!1){let c=a.map(a=>null===a?null:(0,f.is)(this.baseColumn,w)?this.baseColumn.mapToDriverValue(a,!0):this.baseColumn.mapToDriverValue(a));return b?c:function a(b){return`{${b.map(b=>Array.isArray(b)?a(b):"string"==typeof b?`"${b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${b}`).join(",")}}`}(c)}}class x extends r{static [f.i]="PgEnumObjectColumnBuilder";constructor(a,b){super(a,"string","PgEnumObjectColumn"),this.config.enum=b}build(a){return new y(a,this.config)}}class y extends s{static [f.i]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}let z=Symbol.for("drizzle:isPgEnum");class A extends r{static [f.i]="PgEnumColumnBuilder";constructor(a,b){super(a,"string","PgEnumColumn"),this.config.enum=b}build(a){return new B(a,this.config)}}class B extends s{static [f.i]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}var C=c(96176);let D={startActiveSpan:(a,b)=>d?(e||(e=d.trace.getTracer("drizzle-orm","0.45.1")),l((c,d)=>d.startActiveSpan(a,a=>{try{return b(a)}catch(b){throw a.setStatus({code:c.SpanStatusCode.ERROR,message:b instanceof Error?b.message:"Unknown error"}),b}finally{a.end()}}),d,e)):b()};var E=c(19593),F=c(7284);class G{static [f.i]=null}function H(a){return null!=a&&"function"==typeof a.getSQL}class I{static [f.i]="StringChunk";value;constructor(a){this.value=Array.isArray(a)?a:[a]}getSQL(){return new J([this])}}class J{constructor(a){for(let b of(this.queryChunks=a,a))if((0,f.is)(b,F.XI)){let a=b[F.XI.Symbol.Schema];this.usedTables.push(void 0===a?b[F.XI.Symbol.Name]:a+"."+b[F.XI.Symbol.Name])}}static [f.i]="SQL";decoder=M;shouldInlineParams=!1;usedTables=[];append(a){return this.queryChunks.push(...a.queryChunks),this}toQuery(a){return D.startActiveSpan("drizzle.buildSQL",b=>{let c=this.buildQueryFromSourceParams(this.queryChunks,a);return b?.setAttributes({"drizzle.query.text":c.sql,"drizzle.query.params":JSON.stringify(c.params)}),c})}buildQueryFromSourceParams(a,b){let c=Object.assign({},b,{inlineParams:b.inlineParams||this.shouldInlineParams,paramStartIndex:b.paramStartIndex||{value:0}}),{casing:d,escapeName:e,escapeParam:g,prepareTyping:i,inlineParams:j,paramStartIndex:k}=c;var l=a.map(a=>{if((0,f.is)(a,I))return{sql:a.value.join(""),params:[]};if((0,f.is)(a,K))return{sql:e(a.value),params:[]};if(void 0===a)return{sql:"",params:[]};if(Array.isArray(a)){let b=[new I("(")];for(let[c,d]of a.entries())b.push(d),c<a.length-1&&b.push(new I(", "));return b.push(new I(")")),this.buildQueryFromSourceParams(b,c)}if((0,f.is)(a,J))return this.buildQueryFromSourceParams(a.queryChunks,{...c,inlineParams:j||a.shouldInlineParams});if((0,f.is)(a,F.XI)){let b=a[F.XI.Symbol.Schema],c=a[F.XI.Symbol.Name];return{sql:void 0===b||a[F.HE]?e(c):e(b)+"."+e(c),params:[]}}if((0,f.is)(a,h.V)){let c=d.getColumnCasing(a);if("indexes"===b.invokeSource)return{sql:e(c),params:[]};let f=a.table[F.XI.Symbol.Schema];return{sql:a.table[F.HE]||void 0===f?e(a.table[F.XI.Symbol.Name])+"."+e(c):e(f)+"."+e(a.table[F.XI.Symbol.Name])+"."+e(c),params:[]}}if((0,f.is)(a,T)){let b=a[E.n].schema,c=a[E.n].name;return{sql:void 0===b||a[E.n].isAlias?e(c):e(b)+"."+e(c),params:[]}}if((0,f.is)(a,O)){if((0,f.is)(a.value,Q))return{sql:g(k.value++,a),params:[a],typings:["none"]};let b=null===a.value?null:a.encoder.mapToDriverValue(a.value);if((0,f.is)(b,J))return this.buildQueryFromSourceParams([b],c);if(j)return{sql:this.mapInlineParam(b,c),params:[]};let d=["none"];return i&&(d=[i(a.encoder)]),{sql:g(k.value++,b),params:[b],typings:d}}return(0,f.is)(a,Q)?{sql:g(k.value++,a),params:[a],typings:["none"]}:(0,f.is)(a,J.Aliased)&&void 0!==a.fieldAlias?{sql:e(a.fieldAlias),params:[]}:(0,f.is)(a,C.n)?a._.isWith?{sql:e(a._.alias),params:[]}:this.buildQueryFromSourceParams([new I("("),a._.sql,new I(") "),new K(a._.alias)],c):a&&"function"==typeof a&&z in a&&!0===a[z]?a.schema?{sql:e(a.schema)+"."+e(a.enumName),params:[]}:{sql:e(a.enumName),params:[]}:H(a)?a.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([a.getSQL()],c):this.buildQueryFromSourceParams([new I("("),a.getSQL(),new I(")")],c):j?{sql:this.mapInlineParam(a,c),params:[]}:{sql:g(k.value++,a),params:[a],typings:["none"]}});let m={sql:"",params:[]};for(let a of l)m.sql+=a.sql,m.params.push(...a.params),a.typings?.length&&(m.typings||(m.typings=[]),m.typings.push(...a.typings));return m}mapInlineParam(a,{escapeString:b}){if(null===a)return"null";if("number"==typeof a||"boolean"==typeof a)return a.toString();if("string"==typeof a)return b(a);if("object"==typeof a){let c=a.toString();return"[object Object]"===c?b(JSON.stringify(a)):b(c)}throw Error("Unexpected param value: "+a)}getSQL(){return this}as(a){return void 0===a?this:new J.Aliased(this,a)}mapWith(a){return this.decoder="function"==typeof a?{mapFromDriverValue:a}:a,this}inlineParams(){return this.shouldInlineParams=!0,this}if(a){return a?this:void 0}}class K{constructor(a){this.value=a}static [f.i]="Name";brand;getSQL(){return new J([this])}}function L(a){return"object"==typeof a&&null!==a&&"mapToDriverValue"in a&&"function"==typeof a.mapToDriverValue}let M={mapFromDriverValue:a=>a},N={mapToDriverValue:a=>a};({...M,...N});class O{constructor(a,b=N){this.value=a,this.encoder=b}static [f.i]="Param";brand;getSQL(){return new J([this])}}function P(a,...b){let c=[];for(let[d,e]of((b.length>0||a.length>0&&""!==a[0])&&c.push(new I(a[0])),b.entries()))c.push(e,new I(a[d+1]));return new J(c)}(a=>{a.empty=function(){return new J([])},a.fromList=function(a){return new J(a)},a.raw=function(a){return new J([new I(a)])},a.join=function(a,b){let c=[];for(let[d,e]of a.entries())d>0&&void 0!==b&&c.push(b),c.push(e);return new J(c)},a.identifier=function(a){return new K(a)},a.placeholder=function(a){return new Q(a)},a.param=function(a,b){return new O(a,b)}})(P||(P={})),(a=>{class b{constructor(a,b){this.sql=a,this.fieldAlias=b}static [f.i]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new b(this.sql,this.fieldAlias)}}a.Aliased=b})(J||(J={}));class Q{constructor(a){this.name=a}static [f.i]="Placeholder";getSQL(){return new J([this])}}function R(a,b){return a.map(a=>{if((0,f.is)(a,Q)){if(!(a.name in b))throw Error(`No value for placeholder "${a.name}" was provided`);return b[a.name]}if((0,f.is)(a,O)&&(0,f.is)(a.value,Q)){if(!(a.value.name in b))throw Error(`No value for placeholder "${a.value.name}" was provided`);return a.encoder.mapToDriverValue(b[a.value.name])}return a})}let S=Symbol.for("drizzle:IsDrizzleView");class T{static [f.i]="View";[E.n];[S]=!0;constructor({name:a,schema:b,selectedFields:c,query:d}){this[E.n]={name:a,originalName:a,schema:b,selectedFields:c,query:d,isExisting:!d,isAlias:!1}}getSQL(){return new J([this])}}h.V.prototype.getSQL=function(){return new J([this])},F.XI.prototype.getSQL=function(){return new J([this])},C.n.prototype.getSQL=function(){return new J([this])}},89368:(a,b,c)=>{c.d(b,{DM:()=>e});let d=Symbol.for("__cloudflare-context__");function e(a={async:!1}){return a.async?g():function(){let a=f();if(a)return a;if(function(){let a=globalThis;return a.__NEXT_DATA__?.nextExport===!0}())throw Error("\n\nERROR: `getCloudflareContext` has been called in sync mode in either a static route or at the top level of a non-static one, both cases are not allowed but can be solved by either:\n  - make sure that the call is not at the top level and that the route is not static\n  - call `getCloudflareContext({async: true})` to use the `async` mode\n  - avoid calling `getCloudflareContext` in the route\n");throw Error(i)}()}function f(){return globalThis[d]}async function g(){let a=f();if(a)return a;{var b;let a=await h();return b=a,globalThis[d]=b,a}}async function h(a){let{getPlatformProxy:b}=await import(`${"__wrangler".replaceAll("_","")}`),c=a?.environment??process.env.NEXT_DEV_WRANGLER_ENV,{env:d,cf:e,ctx:f}=await b({...a,envFiles:[],environment:c});return{env:d,cf:e,ctx:f}}let i='\n\nERROR: `getCloudflareContext` has been called without having called `initOpenNextCloudflareForDev` from the Next.js config file.\nYou should update your Next.js config file as shown below:\n\n   ```\n   // next.config.mjs\n\n   import { initOpenNextCloudflareForDev } from "@opennextjs/cloudflare";\n\n   initOpenNextCloudflareForDev();\n\n   const nextConfig = { ... };\n   export default nextConfig;\n   ```\n\n'},95417:(a,b,c)=>{c.d(b,{jo:()=>C,D:()=>D});var d=c(46493),e=c(7284),f=c(41313),g=c(31496);class h extends g.o{static [d.i]="SQLiteBigIntBuilder";constructor(a){super(a,"bigint","SQLiteBigInt")}build(a){return new i(a,this.config)}}class i extends g.v{static [d.i]="SQLiteBigInt";getSQLType(){return"blob"}mapFromDriverValue(a){return"undefined"!=typeof Buffer&&Buffer.from?BigInt((Buffer.isBuffer(a)?a:a instanceof ArrayBuffer?Buffer.from(a):a.buffer?Buffer.from(a.buffer,a.byteOffset,a.byteLength):Buffer.from(a)).toString("utf8")):BigInt(f.su.decode(a))}mapToDriverValue(a){return Buffer.from(a.toString())}}class j extends g.o{static [d.i]="SQLiteBlobJsonBuilder";constructor(a){super(a,"json","SQLiteBlobJson")}build(a){return new k(a,this.config)}}class k extends g.v{static [d.i]="SQLiteBlobJson";getSQLType(){return"blob"}mapFromDriverValue(a){return"undefined"!=typeof Buffer&&Buffer.from?JSON.parse((Buffer.isBuffer(a)?a:a instanceof ArrayBuffer?Buffer.from(a):a.buffer?Buffer.from(a.buffer,a.byteOffset,a.byteLength):Buffer.from(a)).toString("utf8")):JSON.parse(f.su.decode(a))}mapToDriverValue(a){return Buffer.from(JSON.stringify(a))}}class l extends g.o{static [d.i]="SQLiteBlobBufferBuilder";constructor(a){super(a,"buffer","SQLiteBlobBuffer")}build(a){return new m(a,this.config)}}class m extends g.v{static [d.i]="SQLiteBlobBuffer";mapFromDriverValue(a){return Buffer.isBuffer(a)?a:Buffer.from(a)}getSQLType(){return"blob"}}function n(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return d?.mode==="json"?new j(c):d?.mode==="bigint"?new h(c):new l(c)}class o extends g.o{static [d.i]="SQLiteCustomColumnBuilder";constructor(a,b,c){super(a,"custom","SQLiteCustomColumn"),this.config.fieldConfig=b,this.config.customTypeParams=c}build(a){return new p(a,this.config)}}class p extends g.v{static [d.i]="SQLiteCustomColumn";sqlName;mapTo;mapFrom;constructor(a,b){super(a,b),this.sqlName=b.customTypeParams.dataType(b.fieldConfig),this.mapTo=b.customTypeParams.toDriver,this.mapFrom=b.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(a){return"function"==typeof this.mapFrom?this.mapFrom(a):a}mapToDriverValue(a){return"function"==typeof this.mapTo?this.mapTo(a):a}}function q(a){return(b,c)=>{let{name:d,config:e}=(0,f.Ll)(b,c);return new o(d,e,a)}}var r=c(20377);class s extends g.o{static [d.i]="SQLiteNumericBuilder";constructor(a){super(a,"string","SQLiteNumeric")}build(a){return new t(a,this.config)}}class t extends g.v{static [d.i]="SQLiteNumeric";mapFromDriverValue(a){return"string"==typeof a?a:String(a)}getSQLType(){return"numeric"}}class u extends g.o{static [d.i]="SQLiteNumericNumberBuilder";constructor(a){super(a,"number","SQLiteNumericNumber")}build(a){return new v(a,this.config)}}class v extends g.v{static [d.i]="SQLiteNumericNumber";mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}mapToDriverValue=String;getSQLType(){return"numeric"}}class w extends g.o{static [d.i]="SQLiteNumericBigIntBuilder";constructor(a){super(a,"bigint","SQLiteNumericBigInt")}build(a){return new x(a,this.config)}}class x extends g.v{static [d.i]="SQLiteNumericBigInt";mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return"numeric"}}function y(a,b){let{name:c,config:d}=(0,f.Ll)(a,b),e=d?.mode;return"number"===e?new u(c):"bigint"===e?new w(c):new s(c)}var z=c(19643),A=c(58040);let B=Symbol.for("drizzle:SQLiteInlineForeignKeys");class C extends e.XI{static [d.i]="SQLiteTable";static Symbol=Object.assign({},e.XI.Symbol,{InlineForeignKeys:B});[e.XI.Symbol.Columns];[B]=[];[e.XI.Symbol.ExtraConfigBuilder]=void 0}let D=(a,b,c)=>(function(a,b,c,d,f=a){let g=new C(a,void 0,f),h=Object.fromEntries(Object.entries("function"==typeof b?b({blob:n,customType:q,integer:r.nd,numeric:y,real:z.x,text:A.Qq}):b).map(([a,b])=>{b.setName(a);let c=b.build(g);return g[B].push(...b.buildForeignKeys(c,g)),[a,c]})),i=Object.assign(g,h);return i[e.XI.Symbol.Columns]=h,i[e.XI.Symbol.ExtraConfigColumns]=h,c&&(i[C.Symbol.ExtraConfigBuilder]=c),i})(a,b,c)},96176:(a,b,c)=>{c.d(b,{J:()=>f,n:()=>e});var d=c(46493);class e{static [d.i]="Subquery";constructor(a,b,c,d=!1,e=[]){this._={brand:"Subquery",sql:a,selectedFields:b,alias:c,isWith:d,usedTables:e}}}class f extends e{static [d.i]="WithSubquery"}},98046:(a,b,c)=>{c.d(b,{Q:()=>e});var d=c(46493);class e{static [d.i]="ColumnBuilder";config;constructor(a,b,c){this.config={name:a,keyAsName:""===a,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:b,columnType:c,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(a){return this.config.default=a,this.config.hasDefault=!0,this}$defaultFn(a){return this.config.defaultFn=a,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(a){return this.config.onUpdateFn=a,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(a){""===this.config.name&&(this.config.name=a)}}}};