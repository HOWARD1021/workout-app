(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[655],{960:(e,t,s)=>{"use strict";async function a(e,t){let s=await fetch("".concat("/api").concat(e),{...t,headers:{"Content-Type":"application/json",...null==t?void 0:t.headers}});if(!s.ok)throw Error("API error: ".concat(s.status));return s.json()}s.d(t,{E3:()=>n,PA:()=>l,gJ:()=>r});let r={list:()=>a("/exercises"),create:e=>a("/exercises",{method:"POST",body:JSON.stringify(e)}),getPrevious:e=>a("/exercises/previous",{method:"POST",body:JSON.stringify({exercise_ids:e})})},l={list:()=>a("/workouts"),create:e=>a("/workouts",{method:"POST",body:JSON.stringify(e)})},n={list:()=>a("/templates"),get:e=>a("/templates/".concat(e)),create:e=>a("/templates",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>a("/templates/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),delete:e=>a("/templates/".concat(e),{method:"DELETE"})}},989:(e,t,s)=>{Promise.resolve().then(s.bind(s,2973))},1834:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>d,L3:()=>m,c7:()=>u,lG:()=>i});var a=s(5155);s(2115);var r=s(5229),l=s(6405),n=s(4269);function i(e){let{...t}=e;return(0,a.jsx)(l.bL,{"data-slot":"dialog",...t})}function o(e){let{...t}=e;return(0,a.jsx)(l.ZL,{"data-slot":"dialog-portal",...t})}function c(e){let{className:t,...s}=e;return(0,a.jsx)(l.hJ,{"data-slot":"dialog-overlay",className:(0,n.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function d(e){let{className:t,children:s,showCloseButton:i=!0,...d}=e;return(0,a.jsxs)(o,{"data-slot":"dialog-portal",children:[(0,a.jsx)(c,{}),(0,a.jsxs)(l.UC,{"data-slot":"dialog-content",className:(0,n.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 outline-none sm:max-w-lg",t),...d,children:[s,i&&(0,a.jsxs)(l.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(r.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function u(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-header",className:(0,n.cn)("flex flex-col gap-2 text-center sm:text-left",t),...s})}function m(e){let{className:t,...s}=e;return(0,a.jsx)(l.hE,{"data-slot":"dialog-title",className:(0,n.cn)("text-lg leading-none font-semibold",t),...s})}s(3998)},2973:(e,t,s)=>{"use strict";s.d(t,{default:()=>b});var a=s(5155),r=s(2115),l=s(3998),n=s(6948),i=s(5142),o=s(5626),c=s(5121);let d=(0,c.A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var u=s(4982);let m=(0,c.A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var x=s(6191);let h=(0,c.A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var p=s(1834),g=s(960),f=s(8722),v=s(63);function b(e){let{onFinish:t,onExercisesChange:s}=e,c=(0,v.useRouter)(),b=(0,v.useSearchParams)().get("template"),[w,y]=(0,r.useState)([]),[C,j]=(0,r.useState)([]),[N,E]=(0,r.useState)(!1),[k]=(0,r.useState)(new Date),[A,F]=(0,r.useState)(0),[_,S]=(0,r.useState)(""),[z,O]=(0,r.useState)(!1),{getPrevious:P,fetchForExercise:M}=function(e){let[t,s]=(0,r.useState)(new Map),[a,l]=(0,r.useState)(!1),n=(0,r.useCallback)(async e=>{if(0!==e.length){l(!0);try{let t=await g.gJ.getPrevious(e),a=new Map;Object.entries(t).forEach(e=>{let[t,s]=e;a.set(t,s)}),s(a)}catch(e){console.error("Failed to fetch previous exercise data:",e)}finally{l(!1)}}},[]);(0,r.useEffect)(()=>{e.length>0&&n(e)},[e.length,n]);let i=(0,r.useCallback)(e=>{let s=t.get(e);return s?"".concat(s.weight,"kg \xd7 ").concat(s.reps):"-- \xd7 --"},[t]);return{previousData:t,loading:a,getPrevious:i,fetchForExercise:(0,r.useCallback)(async e=>{await n([e])},[n]),refetch:()=>n(e)}}((0,r.useMemo)(()=>C.map(e=>e.exercise.id),[C])),{exercises:L}=(0,f.M)(b),{templates:D,updateTemplateUsage:G}=(0,f.o)(),J=(0,r.useMemo)(()=>b&&D.find(e=>e.id===b)||null,[b,D]);(0,r.useEffect)(()=>{if(b&&L.length>0&&!z){let e=L.map(e=>{var t,s,a,r;return{exercise:{id:(null==(t=e.exercise)?void 0:t.id)||"",name:(null==(s=e.exercise)?void 0:s.name)||"",type:(null==(a=e.exercise)?void 0:a.type)||null,muscleGroup:(null==(r=e.exercise)?void 0:r.muscleGroup)||null,isCustom:null,createdAt:null,deletedAt:null},sets:Array.from({length:e.defaultSets||3},(t,s)=>({set_order:s+1,weight:e.defaultWeight||null,reps:e.defaultReps||null,completed:!1}))}});j(()=>e),O(()=>!0),G(b)}},[b,L.length,z]),(0,r.useEffect)(()=>{s&&s(C.map(e=>({exercise_id:e.exercise.id,name:e.exercise.name,muscle_group:e.exercise.muscleGroup||void 0})))},[C,s]),(0,r.useEffect)(()=>{(async()=>{try{let e=await g.gJ.list();y(e)}catch(e){console.error("Failed to fetch exercises:",e)}})()},[]),(0,r.useEffect)(()=>{let e=setInterval(()=>{F(Math.floor((Date.now()-k.getTime())/1e3))},1e3);return()=>clearInterval(e)},[k]);let $=e=>{let t=Math.floor(e/3600),s=Math.floor(e%3600/60);return"".concat(t,":").concat(s.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))},T=async e=>{await M(e.id),j(t=>[...t,{exercise:e,sets:[{set_order:1,weight:null,reps:null,completed:!1}]}]),E(!1),S("")},I=(e,t,s,a)=>{j(r=>{let l=[...r],n=""===a?null:parseFloat(a);return l[e].sets[t][s]=n,l})},Z=(0,r.useCallback)(()=>{let e=0,t=[];return C.forEach(s=>{let a=0;s.sets.forEach(t=>{t.completed&&t.weight&&t.reps&&(e+=t.weight*t.reps,t.weight>a&&(a=t.weight))}),a>0&&t.push({name:s.exercise.name,maxWeight:a})}),{exerciseCount:C.length,totalVolume:Math.round(e),duration:A,exercises:t}},[C,A]),R=async()=>{let e=new Date,s=[];C.forEach(e=>{e.sets.forEach(t=>{t.completed&&s.push({exercise_id:e.exercise.id,set_order:t.set_order,weight:t.weight,reps:t.reps})})});try{await g.PA.create({started_at:k.toISOString(),ended_at:e.toISOString(),template_id:b||void 0,logs:s});let a=Z();t?t(a):c.push("/")}catch(e){console.error("Failed to save workout:",e)}},B=w.filter(e=>e.name.toLowerCase().includes(_.toLowerCase())||(e.muscleGroup||"").toLowerCase().includes(_.toLowerCase())).reduce((e,t)=>{let s=t.muscleGroup||"Other";return e[s]||(e[s]=[]),e[s].push(t),e},{});return(0,a.jsxs)("div",{className:"min-h-screen bg-[#F7F7F7]",children:[(0,a.jsx)("div",{className:"bg-white border-b sticky top-0 z-10",children:(0,a.jsx)("div",{className:"max-w-2xl mx-auto px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(l.$,{variant:"ghost",size:"sm",onClick:()=>c.push("/"),children:[(0,a.jsx)(o.A,{className:"h-4 w-4 mr-1"}),"Back"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-[#3C3C3C]",children:[(0,a.jsx)(d,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"font-mono text-lg",children:$(A)})]}),(0,a.jsx)(l.$,{className:"bg-[#58CC02] hover:bg-[#46A302] text-white",onClick:R,disabled:0===C.length,children:"Finish"})]})})}),(0,a.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[(0,a.jsx)(n.Zp,{className:"bg-white border-2 border-[#E5E5E5] mb-4",children:(0,a.jsx)(n.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-4xl",children:"\uD83E\uDD86"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-[#3C3C3C]",children:J?J.name:"自由訓練"}),(0,a.jsxs)("p",{className:"text-[#AFAFAF] text-sm",children:[k.toLocaleDateString()," - ",$(A),(null==J?void 0:J.muscleGroup)&&(0,a.jsx)("span",{className:"ml-2 px-2 py-0.5 rounded-full bg-[#E8F5E9] text-[#58CC02] text-xs",children:J.muscleGroup})]})]})]})})}),C.map((e,t)=>(0,a.jsxs)(n.Zp,{className:"bg-white border-2 border-[#E5E5E5] mb-4",children:[(0,a.jsx)(n.aR,{className:"pb-2",children:(0,a.jsxs)(n.ZB,{className:"flex items-center gap-2 text-[#3C3C3C]",children:[(0,a.jsx)(u.A,{className:"h-5 w-5"}),e.exercise.name]})}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-[40px_1fr_80px_80px_50px] gap-2 mb-2 text-sm text-[#AFAFAF] font-medium",children:[(0,a.jsx)("div",{children:"Set"}),(0,a.jsx)("div",{children:"Previous"}),(0,a.jsx)("div",{className:"text-center",children:"kg"}),(0,a.jsx)("div",{className:"text-center",children:"Reps"}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(m,{className:"h-4 w-4 mx-auto"})})]}),e.sets.map((s,r)=>{var n,o;return(0,a.jsxs)("div",{className:"grid grid-cols-[40px_1fr_80px_80px_50px] gap-2 mb-2 items-center transition-all duration-200 ".concat(s.completed?"bg-[#C8F7C5] rounded-lg p-2 -mx-1 border-2 border-[#58CC02]":""),children:[(0,a.jsx)("div",{className:"font-bold ".concat(s.completed?"text-[#58CC02]":"text-[#3C3C3C]"),children:s.set_order}),(0,a.jsx)("div",{className:"text-sm ".concat(s.completed?"text-[#58CC02] line-through":"text-[#AFAFAF]"),children:P(e.exercise.id)}),(0,a.jsx)(i.p,{type:"number",placeholder:"0",value:null!=(n=s.weight)?n:"",onChange:e=>I(t,r,"weight",e.target.value),className:"h-10 text-center border-2 ".concat(s.completed?"border-[#58CC02] bg-white text-[#58CC02] font-bold":"border-[#E5E5E5] focus:border-[#58CC02]"),disabled:s.completed}),(0,a.jsx)(i.p,{type:"number",placeholder:"0",value:null!=(o=s.reps)?o:"",onChange:e=>I(t,r,"reps",e.target.value),className:"h-10 text-center border-2 ".concat(s.completed?"border-[#58CC02] bg-white text-[#58CC02] font-bold":"border-[#E5E5E5] focus:border-[#58CC02]"),disabled:s.completed}),(0,a.jsx)(l.$,{variant:s.completed?"default":"outline",size:"icon",className:s.completed?"bg-[#58CC02] hover:bg-[#46A302] text-white shadow-md":"border-2 border-[#E5E5E5] text-[#AFAFAF] hover:border-[#58CC02] hover:text-[#58CC02]",onClick:()=>((e,t)=>{let s=C[e].sets[t];if(!s.completed&&(null===s.weight||s.weight<=0||null===s.reps||s.reps<=0))return void alert("請先輸入重量和次數！");j(s=>s.map((s,a)=>a!==e?s:{...s,sets:s.sets.map((e,s)=>s!==t?e:{...e,completed:!e.completed})}))})(t,r),children:(0,a.jsx)(m,{className:"h-5 w-5"})})]},r)}),(0,a.jsx)("div",{className:"flex justify-center my-3",children:(0,a.jsxs)(l.$,{variant:"outline",size:"sm",className:"border-2 border-[#E5E5E5] text-[#AFAFAF]",children:[(0,a.jsx)(d,{className:"h-4 w-4 mr-1"}),"1:00"]})}),(0,a.jsxs)(l.$,{variant:"outline",className:"w-full border-2 border-[#58CC02] text-[#58CC02] hover:bg-[#E8F5E9]",onClick:()=>{j(e=>{let s=[...e],a=s[t];return a.sets.push({set_order:a.sets.length+1,weight:null,reps:null,completed:!1}),s})},children:[(0,a.jsx)(x.A,{className:"h-4 w-4 mr-1"}),"Add Set"]})]})]},t)),(0,a.jsxs)(l.$,{className:"w-full bg-[#1CB0F6] hover:bg-[#0A9AD6] text-white py-6",onClick:()=>E(!0),children:[(0,a.jsx)(x.A,{className:"h-5 w-5 mr-2"}),"Add Exercise"]})]}),(0,a.jsx)(p.lG,{open:N,onOpenChange:E,children:(0,a.jsxs)(p.Cf,{className:"max-w-md max-h-[80vh] overflow-y-auto",children:[(0,a.jsx)(p.c7,{children:(0,a.jsx)(p.L3,{children:"Select Exercise"})}),(0,a.jsx)(i.p,{placeholder:"Search exercises...",value:_,onChange:e=>S(e.target.value),className:"mb-4"}),(0,a.jsx)("div",{className:"space-y-4",children:Object.entries(B).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-[#AFAFAF] mb-2 flex items-center",children:[(0,a.jsx)(h,{className:"h-4 w-4 mr-1"}),t]}),(0,a.jsx)("div",{className:"space-y-1",children:s.map(e=>(0,a.jsxs)(l.$,{variant:"ghost",className:"w-full justify-start text-[#3C3C3C] hover:bg-[#F7F7F7]",onClick:()=>T(e),children:[(0,a.jsx)(u.A,{className:"h-4 w-4 mr-2 text-[#AFAFAF]"}),e.name]},e.id))})]},t)})})]})})]})}},3998:(e,t,s)=>{"use strict";s.d(t,{$:()=>o});var a=s(5155);s(2115);var r=s(3101),l=s(2467),n=s(4269);let i=(0,r.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",xs:"h-6 gap-1 rounded-md px-2 text-xs has-[>svg]:px-1.5 [&_svg:not([class*='size-'])]:size-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-xs":"size-6 rounded-md [&_svg:not([class*='size-'])]:size-3","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:s="default",size:r="default",asChild:o=!1,...c}=e,d=o?l.bL:"button";return(0,a.jsx)(d,{"data-slot":"button","data-variant":s,"data-size":r,className:(0,n.cn)(i({variant:s,size:r,className:t})),...c})}},4269:(e,t,s)=>{"use strict";s.d(t,{cn:()=>l});var a=s(2821),r=s(5889);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,a.$)(t))}},5142:(e,t,s)=>{"use strict";s.d(t,{p:()=>l});var a=s(5155);s(2115);var r=s(4269);function l(e){let{className:t,type:s,...l}=e;return(0,a.jsx)("input",{type:s,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...l})}},5626:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(5121).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6948:(e,t,s)=>{"use strict";s.d(t,{Wu:()=>o,ZB:()=>i,Zp:()=>l,aR:()=>n});var a=s(5155);s(2115);var r=s(4269);function l(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function n(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function i(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",t),...s})}function o(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",t),...s})}},8722:(e,t,s)=>{"use strict";s.d(t,{M:()=>n,o:()=>l});var a=s(2115),r=s(960);function l(){let[e,t]=(0,a.useState)([]),[s,l]=(0,a.useState)(!0),[n,i]=(0,a.useState)(null),o=(0,a.useCallback)(async()=>{l(!0),i(null);try{let e=await r.E3.list();t(e)}catch(e){console.error("Failed to fetch templates:",e),i(e instanceof Error?e.message:"Failed to fetch templates")}finally{l(!1)}},[]);(0,a.useEffect)(()=>{o()},[o]);let c=(0,a.useCallback)(async(e,t,s,a,l)=>{try{let n=await r.E3.create({name:e,exercises:t,description:s,is_favorite:a,muscle_group:l});return await o(),n.id}catch(e){throw console.error("Failed to create template:",e),e}},[o]),d=(0,a.useCallback)(async t=>{try{let s=e.find(e=>e.id===t);await r.E3.update(t,{use_count:((null==s?void 0:s.useCount)||0)+1,last_used_at:new Date().toISOString()})}catch(e){console.error("Failed to update template usage:",e)}},[e]),u=(0,a.useCallback)(async e=>{try{await r.E3.delete(e),await o()}catch(e){throw console.error("Failed to delete template:",e),e}},[o]),m=(0,a.useCallback)(async(e,t)=>{try{await r.E3.update(e,{is_favorite:t}),await o()}catch(e){throw console.error("Failed to toggle favorite:",e),e}},[o]);return{templates:e,loading:s,error:n,refetch:o,createTemplate:c,updateTemplateUsage:d,deleteTemplate:u,toggleFavorite:m}}function n(e){let[t,s]=(0,a.useState)([]),[l,n]=(0,a.useState)(!1),[i,o]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(!e)return void s([]);(async()=>{n(!0),o(null);try{let t=await r.E3.get(e);s(t)}catch(e){console.error("Failed to fetch template details:",e),o(e instanceof Error?e.message:"Failed to fetch template details")}finally{n(!1)}})()},[e]),{exercises:t,loading:l,error:i}}}},e=>{e.O(0,[73,131,441,255,358],()=>e(e.s=989)),_N_E=e.O()}]);